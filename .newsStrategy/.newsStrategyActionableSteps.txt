================================================================================
NEWS TRADING STRATEGY - ACTIONABLE IMPLEMENTATION STEPS
================================================================================
Status: Documentation 100% Complete | Implementation 85% Complete
Last Updated: November 7, 2025

This document provides a gap analysis of the News Trading Strategy framework
and defines prioritized actionable steps to reach production readiness for
the 4-week testing campaign.

================================================================================
SECTION 1: WHAT WE HAVE (85% COMPLETE)
================================================================================

‚úÖ STRATEGIC FRAMEWORK (100% Complete)
---------------------------------------
- .newsStrategyTestGoal.txt (600+ lines)
  - Complete S1-S5 strategy definitions
  - Implementation status for each strategy
  - Data collection objectives
  - Success metrics and production model design goals

- .newsStrategyStatCapture.txt (700+ lines)
  - 28-field trade-level data schema
  - 20-metric strategy-level aggregates
  - Visualization specifications
  - MT5 data requirements

- .newsStrategyRiskProfile.txt (800+ lines)
  - Position sizing formulas (static and ATR-based)
  - Risk limits per strategy (0.25%-0.50% per trade)
  - Weekly target logic (+1% weekly goal)
  - No weekly loss cap (capture recovery behavior)

‚úÖ INFRASTRUCTURE (100% Complete)
----------------------------------
- Per-Pair Limit Infrastructure:
  - news_filter_maxTradePerPair variable created in Globals.py
  - _PairCount_ dictionary created and initialized
  - _PairCount_ logging integrated in save_news_dictionaries.py
  - Ready for S4 per-pair limit logic

- Dynamic Lot Sizing Infrastructure:
  - _Symbols_ updated with ATR = 0 field
  - _Symbols_ updated with accBalance = 100000
  - _Symbols_ updated with lot_size_percentage = 0.0025
  - Ready for account balance-based position sizing

- Bug Fixes:
  - Infinite loop bug fixed (3-part solution)
  - NID_Affect filtering respects news_filter_findAllPairs
  - Output.txt automatic logging with TeeOutput class

‚úÖ CURRENT CAPABILITIES (S1/S2 Ready)
--------------------------------------
- S1 (Sequential Same-Pair): 100% ready to test
  - Execution: One position per pair, sequential entries
  - Risk: Static 0.25%, TP=500, SL=250
  - Status: Can begin testing immediately

- S2 (Multi-Pair with Alternatives): 100% ready to test
  - Execution: Alternatives if primary pair at limit
  - Risk: Static 0.25%, TP=500, SL=250
  - Status: Can begin testing immediately

================================================================================
SECTION 2: WHAT WE DON'T HAVE (15% MISSING)
================================================================================

‚ùå CRITICAL BLOCKERS (10% - Must Implement Before Testing)
-----------------------------------------------------------

1. CSV LOGGING SCHEMA (Priority: CRITICAL)
   Status: Schema defined, writer function NOT implemented
   Blocking: Cannot capture trade-level data for analysis
   Impact: 28-field trade log will not be written to disk
   
   What's Missing:
   - trades_log.py module with CSV writer function
   - CSV file initialization with headers
   - Record writing logic (call after each trade)
   - File rotation/session management
   
   Implementation Time: ~2 hours
   
   Files to Create:
   - trades_log.py (new module)
   
   Files to Modify:
   - News.py (add logging calls after trade execution)
   - Server.py (initialize CSV at startup)

2. SURPRISE STRENGTH CALCULATION (Priority: CRITICAL)
   Status: Data available (actual, forecast), formula NOT implemented
   Blocking: Cannot analyze surprise impact on trade performance
   Impact: Key correlation metric missing from analysis
   
   What's Missing:
   - Calculate: (actual - forecast) / forecast
   - Store in trade record
   - Add to CSV output
   
   Implementation Time: ~30 minutes
   
   Files to Modify:
   - News.py (add calculation in STEP 7, around line 838)
   - trades_log.py (add field to write_trade_record function)


‚ùå IMPORTANT COMPONENTS (3% - Needed for S4/S5)
------------------------------------------------

3. ATR PIPELINE FROM MT5 TO PYTHON (Priority: HIGH)
   Status: Field created in _Symbols_, pipeline NOT implemented
   Blocking: S4 and S5 cannot calculate dynamic position sizes
   Impact: ATR-based strategies (S4/S5) cannot execute
   
   What's Missing:
   - MT5 sends ATR values via HTTP request
   - Python stores ATR in _Symbols_[pair]["ATR"]
   - Dynamic lot sizing uses ATR for TP/SL calculation
   
   Implementation Time: ~3 hours
   
   Files to Create:
   - None (use existing HTTP endpoints)
   
   Files to Modify:
   - Server.py (add /update_atr endpoint)
   - MQL5X.mq5 (add ATR calculation and send logic)
   - News.py (use ATR in position sizing for S4/S5)

4. S4 PER-PAIR LIMIT LOGIC (Priority: MEDIUM)
   Status: Variable created, enforcement logic NOT implemented
   Blocking: S4 cannot enforce "max 1 position per pair" rule
   Impact: S4 will not function as designed
   
   What's Missing:
   - can_open_trade() function to check _PairCount_
   - update_pair_count() function to increment/decrement
   - Integration in trade execution flow
   
   Implementation Time: ~2 hours
   
   Files to Modify:
   - News.py (add can_open_trade check before execution)
   - News.py (add update_pair_count after execution and close)


‚ùå NICE-TO-HAVE COMPONENTS (2% - Can Defer)
--------------------------------------------

5. WEEKLY AGGREGATION SCRIPT (Priority: LOW)
   Status: Metrics defined, aggregation script NOT implemented
   Blocking: Nothing (can aggregate manually with Excel/pandas)
   Impact: Manual weekly analysis required
   
   What's Missing:
   - weekly_aggregator.py module
   - Read trades_log.csv
   - Calculate 20 aggregate metrics per strategy
   - Output weekly summary CSV
   
   Implementation Time: ~4 hours
   
   Files to Create:
   - weekly_aggregator.py (new standalone script)
   
   Notes:
   - Can use pandas.read_csv() for initial testing
   - Automation is convenience, not critical path

6. VISUALIZATION PIPELINE (Priority: LOW)
   Status: Specs defined, visualization scripts NOT implemented
   Blocking: Nothing (data collection is independent)
   Impact: Manual charting required (Excel/Tableau)
   
   What's Missing:
   - visualizations.py module
   - 5 chart types: equity curves, heatmaps, scatter plots, bar charts, tables
   - Use matplotlib/seaborn/plotly
   
   Implementation Time: ~6 hours
   
   Files to Create:
   - visualizations.py (new standalone script)
   
   Notes:
   - Post-collection tool
   - Can build incrementally during testing

7. S3 CLOSE COMMAND INFRASTRUCTURE (Priority: MEDIUM)
   Status: Strategy defined, close logic NOT implemented
   Blocking: S3 cannot execute rolling behavior
   Impact: S3 will not function as designed
   
   What's Missing:
   - _CurrencyPositions_ tracking dictionary
   - Reversal detection logic (sentiment flip)
   - Close command to MT5 for existing position
   - Open command for new position in opposite direction
   
   Implementation Time: ~4 hours
   
   Files to Modify:
   - Globals.py (create _CurrencyPositions_ dictionary)
   - News.py (add reversal detection in STEP 7)
   - News.py (add close + open command logic)

8. S5 SENTIMENT AGGREGATION AND SCALING (Priority: MEDIUM)
   Status: Strategy defined, scaling logic NOT implemented
   Blocking: S5 cannot adjust position sizes dynamically
   Impact: S5 will not function as designed
   
   What's Missing:
   - Aggregate sentiment across all active events
   - Scale lot_size_percentage: 0.25% ‚Üí 0.50% based on strength
   - Apply scaling before position sizing calculation
   
   Implementation Time: ~6 hours
   
   Files to Modify:
   - News.py (add sentiment aggregation function)
   - News.py (add scaling logic in position sizing)


================================================================================
SECTION 3: WHAT WE DON'T NEED (Explicitly Out of Scope)
================================================================================

‚ùå Real-Time API Integration
   - Rationale: CSV + batch analysis is sufficient for testing phase
   - Avoid: Complex API frameworks, real-time dashboards

‚ùå Complex Version Control for Data
   - Rationale: Git + timestamped CSVs handle versioning
   - Avoid: Custom data versioning systems

‚ùå Database Infrastructure
   - Rationale: CSV files handle 4-week volume (<10K trades)
   - Avoid: PostgreSQL, MySQL, MongoDB setup

‚ùå Live Production Deployment
   - Rationale: This is a testing phase, not production
   - Avoid: Docker containers, cloud deployment, CI/CD pipelines


================================================================================
SECTION 4: PRIORITIZED ACTION PLAN
================================================================================

üìã PHASE 1: CRITICAL COMPONENTS (THIS WEEK)
--------------------------------------------
Goal: Enable S1/S2 testing with full data capture

‚úÖ Step 1.1: Implement CSV Logging Schema (~2 hours)
   What to Do:
   - Create trades_log.py module
   - Define write_trade_record(trade_data) function
   - Initialize CSV with 28-column headers at startup
   - Add logging calls in News.py after trade execution
   - Test with mock trade to verify file writing
   
   Expected Output:
   - trades_log.csv created in News_Analyzer/ folder
   - Headers: TID, NID, Timestamp, StrategyID, Pair, Side, EntryPrice, etc.
   - One row per trade

‚úÖ Step 1.2: Add Surprise Strength Calculation (~30 minutes)
   What to Do:
   - In News.py STEP 7 (around line 838), calculate:
     surprise = (actual - forecast) / forecast
   - Store in trade record dictionary
   - Add to CSV output in trades_log.py
   
   Expected Output:
   - surprise field populated for each trade
   - Values like -0.15 (15% negative surprise), +0.32 (32% positive surprise)

‚úÖ Step 1.3: Test S1 and S2 with Data Capture
   What to Do:
   - Set news_strategy = 1, run EA for 2-3 events
   - Verify trades_log.csv captures all 28 fields correctly
   - Set news_strategy = 2, repeat test
   - Manually review CSV for data quality
   
   Expected Output:
   - trades_log.csv with 5-10 test trades
   - All 28 fields populated correctly
   - Surprise calculation verified


üìã PHASE 2: IMPORTANT COMPONENTS (WEEK 2)
------------------------------------------
Goal: Enable S4 testing with ATR-based position sizing

‚úÖ Step 2.1: Build Weekly Aggregation Script (~4 hours)
   What to Do:
   - Create weekly_aggregator.py module
   - Use pandas to read trades_log.csv
   - Group by StrategyID
   - Calculate 20 aggregate metrics:
     - Total Trades, Win Rate, Total PnL, Avg Trade PnL
     - Max DD, Sharpe Ratio, Profit Factor, etc.
   - Output to weekly_summary.csv
   
   Expected Output:
   - weekly_summary.csv with one row per strategy
   - 20 columns of aggregate metrics

‚úÖ Step 2.2: Implement S4 Per-Pair Limit Logic (~2 hours)
   What to Do:
   - Add can_open_trade(pair) function in News.py
   - Check: _PairCount_[pair] < news_filter_maxTradePerPair
   - Add update_pair_count(pair, delta) function
   - Call update_pair_count(pair, +1) after trade open
   - Call update_pair_count(pair, -1) after trade close
   - Integrate can_open_trade() check before execution
   
   Expected Output:
   - S4 respects max 1 position per pair rule
   - _PairCount_ updates correctly in news_dictionaries.txt

‚úÖ Step 2.3: Add ATR Pipeline from MT5 to Python (~3 hours)
   What to Do:
   - In MQL5X.mq5, calculate ATR(14) for each pair
   - Create /update_atr endpoint in Server.py
   - Send: {"pair": "EURUSD", "atr": 0.00085}
   - Python stores: _Symbols_["EURUSD"]["ATR"] = 0.00085
   - Modify position sizing logic to use ATR for TP/SL:
     - TP = entry_price ¬± (2 √ó ATR)
     - SL = entry_price ¬± (1 √ó ATR)
   
   Expected Output:
   - ATR values update every heartbeat in _Symbols_
   - S4 uses dynamic TP/SL based on ATR


üìã PHASE 3: ENHANCEMENT COMPONENTS (WEEK 3-4)
----------------------------------------------
Goal: Enable S3 and S5 testing, build visualization tools

‚úÖ Step 3.1: Implement S3 Close Command Infrastructure (~4 hours)
   What to Do:
   - Create _CurrencyPositions_ dictionary in Globals.py:
     {"EUR": {"pair": "EURUSD", "side": "BUY", "TID": 123}, ...}
   - Add reversal detection in STEP 7:
     - Check if new sentiment opposes _CurrencyPositions_[currency]
   - If reversal detected:
     - Send close command to MT5 for existing position
     - Clear _CurrencyPositions_[currency]
     - Open new position in opposite direction
     - Update _CurrencyPositions_[currency]
   
   Expected Output:
   - S3 closes EUR long when new event suggests EUR short
   - _CurrencyPositions_ tracking works correctly

‚úÖ Step 3.2: Build Visualization Scripts (~6 hours)
   What to Do:
   - Create visualizations.py module
   - Chart 1: Equity Curve (matplotlib line plot)
   - Chart 2: Win/Loss Heatmap (seaborn heatmap)
   - Chart 3: Surprise vs PnL Scatter (matplotlib scatter)
   - Chart 4: Strategy Comparison Bar Chart (matplotlib bar)
   - Chart 5: Summary Table (pandas DataFrame to HTML)
   
   Expected Output:
   - 5 PNG files: equity_curve.png, heatmap.png, scatter.png, bars.png, table.html

‚úÖ Step 3.3: Implement S5 Sentiment Aggregation and Scaling (~6 hours)
   What to Do:
   - Create aggregate_sentiment() function in News.py
   - For each active event, calculate surprise strength
   - Aggregate: avg_surprise = sum(surprises) / count
   - Scale lot_size_percentage:
     - Base: 0.25%
     - Scaled: 0.25% + (0.25% √ó abs(avg_surprise))
     - Max: 0.50% (cap at 2√ó base)
   - Apply scaled percentage before position sizing
   
   Expected Output:
   - S5 position sizes increase with aggregate surprise strength
   - Max 0.50% risk per trade (double base risk)

‚úÖ Step 3.4: Run All 5 Strategies in Parallel
   What to Do:
   - Configure 5 separate EA instances (one per strategy)
   - Run simultaneously for final 1-2 weeks
   - Monitor trades_log.csv for data quality
   - Run weekly_aggregator.py every Friday
   - Generate visualizations at end of Week 4
   
   Expected Output:
   - trades_log.csv with 5,000-10,000 total trades
   - weekly_summary.csv with 20 rows (5 strategies √ó 4 weeks)
   - 5 visualization files for final analysis


================================================================================
SECTION 5: IMPLEMENTATION CHECKLIST
================================================================================

üìã PRE-TESTING PHASE (Before Week 1)
-------------------------------------
[ ] Create trades_log.py module
[ ] Implement write_trade_record() function
[ ] Initialize CSV with 28-column headers
[ ] Add surprise strength calculation in News.py
[ ] Test CSV logging with mock trades
[ ] Verify all 28 fields populate correctly

üìã WEEK 1: S1/S2 TESTING
-------------------------
[ ] Enable S1 (news_strategy = 1)
[ ] Run S1 for 3-5 events, verify data capture
[ ] Enable S2 (news_strategy = 2)
[ ] Run S2 for 3-5 events, verify data capture
[ ] Manually review trades_log.csv for quality
[ ] Begin building weekly_aggregator.py (optional)

üìã WEEK 2: S4 TESTING + ATR PIPELINE
-------------------------------------
[ ] Implement S4 per-pair limit logic (can_open_trade)
[ ] Implement update_pair_count tracking
[ ] Add ATR calculation in MQL5X.mq5
[ ] Create /update_atr endpoint in Server.py
[ ] Modify position sizing to use ATR for TP/SL
[ ] Enable S4 (news_strategy = 4)
[ ] Run S4 for 5-7 events, verify ATR-based sizing
[ ] Finish weekly_aggregator.py script
[ ] Run first weekly aggregation (Week 1 + Week 2 data)

üìã WEEK 3: S3 TESTING + VISUALIZATION
--------------------------------------
[ ] Create _CurrencyPositions_ dictionary in Globals.py
[ ] Implement reversal detection logic in News.py
[ ] Add close + open command logic for S3
[ ] Enable S3 (news_strategy = 3)
[ ] Run S3 for 5-7 events, verify rolling behavior
[ ] Begin building visualizations.py
[ ] Create equity curve chart
[ ] Create heatmap chart
[ ] Run second weekly aggregation

üìã WEEK 4: S5 TESTING + FULL ANALYSIS
--------------------------------------
[ ] Implement aggregate_sentiment() function
[ ] Implement lot_size_percentage scaling logic
[ ] Enable S5 (news_strategy = 5)
[ ] Run S5 for 5-7 events, verify adaptive sizing
[ ] Finish all visualization scripts
[ ] Run all 5 strategies in parallel for final 3-5 days
[ ] Run final weekly aggregation
[ ] Generate all visualization files
[ ] Compile final analysis report


================================================================================
SECTION 6: FILE STRUCTURE BLUEPRINT
================================================================================

News_Analyzer/
‚îÇ
‚îú‚îÄ‚îÄ Core EA Files (Existing)
‚îÇ   ‚îú‚îÄ‚îÄ News_Analyzer.mq5
‚îÇ   ‚îú‚îÄ‚îÄ News_Analyzer.mqproj
‚îÇ   ‚îú‚îÄ‚îÄ Server.py
‚îÇ   ‚îú‚îÄ‚îÄ News.py
‚îÇ   ‚îú‚îÄ‚îÄ Globals.py
‚îÇ   ‚îú‚îÄ‚îÄ Functions.py
‚îÇ   ‚îî‚îÄ‚îÄ (other existing files)
‚îÇ
‚îú‚îÄ‚îÄ Documentation Files (Existing)
‚îÇ   ‚îú‚îÄ‚îÄ .newsStrategyTestGoal.txt
‚îÇ   ‚îú‚îÄ‚îÄ .newsStrategyStatCapture.txt
‚îÇ   ‚îú‚îÄ‚îÄ .newsStrategyRiskProfile.txt
‚îÇ   ‚îî‚îÄ‚îÄ .newsStrategyActionableSteps.txt (this file)
‚îÇ
‚îú‚îÄ‚îÄ Data Collection Modules (TO CREATE)
‚îÇ   ‚îú‚îÄ‚îÄ trades_log.py                    # CSV writer for trade-level data
‚îÇ   ‚îú‚îÄ‚îÄ weekly_aggregator.py             # Calculate 20 aggregate metrics
‚îÇ   ‚îî‚îÄ‚îÄ visualizations.py                # Generate 5 chart types
‚îÇ
‚îî‚îÄ‚îÄ Data Output Files (AUTO-GENERATED)
    ‚îú‚îÄ‚îÄ trades_log.csv                   # 28-column trade log (main data file)
    ‚îú‚îÄ‚îÄ weekly_summary.csv               # 20-column weekly aggregates
    ‚îú‚îÄ‚îÄ equity_curve.png                 # Visualization outputs
    ‚îú‚îÄ‚îÄ heatmap.png
    ‚îú‚îÄ‚îÄ scatter.png
    ‚îú‚îÄ‚îÄ bars.png
    ‚îî‚îÄ‚îÄ summary_table.html


trades_log.csv Schema (28 Columns):
-----------------------------------
TID, NID, Timestamp, StrategyID, Pair, Side, EntryPrice, LotSize, 
SL, TP, ExitPrice, ExitTimestamp, PnL, HoldTime, MaxAdverseExcursion, 
MaxFavorableExcursion, Event, Forecast, Actual, Currency, Sentiment, 
Surprise, IsHighImpact, IsSequential, IsAlternative, IsReversal, 
IsScaled, AccBalanceAtEntry

weekly_summary.csv Schema (20 Columns):
---------------------------------------
StrategyID, TotalTrades, WinRate, TotalPnL, AvgTradePnL, MaxDD, 
MaxDDPercent, RecoveryTime, Sharpe, ProfitFactor, AvgWin, AvgLoss, 
LargestWin, LargestLoss, AvgHoldTime, HighImpactWinRate, AvgMAE, 
AvgMFE, SurpriseCorrelation, WeeklyTarget


================================================================================
SECTION 7: ESTIMATED TIME TO COMPLETION
================================================================================

Component                          Time Estimate    Priority    Week
------------------------------------------------------------------------
CSV Logging Schema                 2 hours          CRITICAL    Week 1
Surprise Strength Calculation      30 minutes       CRITICAL    Week 1
S1/S2 Testing                      Ongoing          CRITICAL    Week 1

Weekly Aggregation Script          4 hours          IMPORTANT   Week 2
S4 Per-Pair Limit Logic            2 hours          IMPORTANT   Week 2
ATR Pipeline (MT5 ‚Üí Python)        3 hours          IMPORTANT   Week 2
S4 Testing                         Ongoing          IMPORTANT   Week 2

S3 Close Command Infrastructure    4 hours          MEDIUM      Week 3
Visualization Scripts              6 hours          LOW         Week 3
S3 Testing                         Ongoing          MEDIUM      Week 3

S5 Sentiment Aggregation           6 hours          MEDIUM      Week 4
S5 Testing                         Ongoing          MEDIUM      Week 4
Final Analysis & Reporting         4 hours          LOW         Week 4

------------------------------------------------------------------------
TOTAL IMPLEMENTATION TIME:         ~31.5 hours
TOTAL TESTING TIME:                4 weeks


================================================================================
SECTION 8: SUCCESS CRITERIA
================================================================================

‚úÖ MINIMUM VIABLE PRODUCT (Week 1 Start)
-----------------------------------------
- CSV logging captures all 28 fields correctly
- Surprise strength calculation works
- S1 and S2 can be tested with full data capture

‚úÖ FULL TESTING CAPABILITY (Week 2 Start)
------------------------------------------
- S1, S2, and S4 fully operational
- ATR pipeline delivers dynamic position sizing
- Weekly aggregation script calculates 20 metrics

‚úÖ COMPLETE FRAMEWORK (Week 3-4)
---------------------------------
- All 5 strategies (S1-S5) fully operational
- Visualization pipeline generates 5 chart types
- 4-week test campaign produces comprehensive analysis

‚úÖ PRODUCTION READINESS (End of Week 4)
----------------------------------------
- 5,000-10,000 trades captured in trades_log.csv
- Weekly summaries show statistical significance
- Visualizations reveal strategy strengths/weaknesses
- Clear winner identified for production deployment


================================================================================
SECTION 9: RISK MITIGATION
================================================================================

‚ö†Ô∏è POTENTIAL BLOCKERS
----------------------
1. ATR Integration Issues
   - Mitigation: Start with static ATR values for S4 testing
   - Fallback: Test S1/S2/S3 first, defer S4/S5 to Week 3

2. Data Quality Problems
   - Mitigation: Manual CSV review after first 10 trades
   - Fallback: Fix schema errors immediately, re-test

3. Time Constraints
   - Mitigation: Prioritize CSV logging + surprise calculation
   - Fallback: Defer visualization to post-collection phase


================================================================================
END OF ACTIONABLE STEPS DOCUMENT
================================================================================

This document provides a complete roadmap from current state (85% ready) to
production-ready testing framework (100% ready). Follow the 3-phase plan to
systematically implement missing components while maintaining focus on the
4-week testing campaign objective.

Next Step: Implement Phase 1 (CSV Logging + Surprise Calculation) to begin
S1/S2 testing this week.
