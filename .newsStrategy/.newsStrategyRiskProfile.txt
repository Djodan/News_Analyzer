================================================================================
NEWS TRADING STRATEGY - RISK & SIZING PROFILE
================================================================================
Purpose: Define position sizing, risk management, and stop conditions for S1-S5
Objective: Fair comparison across strategies with consistent risk-adjusted metrics
Weekly Target: +1% profit (strategies continue until reached, no loss cap)
================================================================================

GLOBAL RISK & SIZING FRAMEWORK
================================================================================

GLOBAL CONSTANTS
────────────────
AccountRiskPerTrade = 0.25%         # Risk per trade as % of account balance
RewardToRisk = 2:1                  # TP is 2× SL (consistent across all strategies)
WeeklyTarget = 1.0%                 # Stop trading only after +1% total profit achieved
CurrencyExposureLimit = 1.0%        # Max risk per currency (sum of open positions)
TotalExposureLimit = 2.0%           # Max risk across all trades combined

CRITICAL RULES
──────────────
✅ No weekly loss cap - all strategies continue trading until +1% profit reached
✅ No early stop on drawdown - capture full recovery behavior for resilience analysis
✅ All strategies maintain 2:1 reward-to-risk ratio for fair comparison
✅ Position sizing adjusts by account balance dynamically


STRATEGY-SPECIFIC CONFIGURATIONS
================================================================================

┌──────────────────────────────────────────────────────────────────────────┐
│ S1: SEQUENTIAL SAME-PAIR MODE                                            │
└──────────────────────────────────────────────────────────────────────────┘

GOAL: Measure raw news reaction strength with pure signal accuracy

RISK METHOD: Static fixed-risk sizing (baseline)

Risk Parameters:
────────────────
RiskPerTrade = 0.25%
TP = 500 points
SL = 250 points
RewardToRisk = 2:1

Execution Logic:
────────────────
- Every event opens its own trade
- No closing of conflicting signals (holds all positions)
- Captures raw hit rate of event-based direction
- One pair per currency (e.g., only EURUSD for EUR)

Market Data Required:
─────────────────────
None (static sizing)

EA Variables Structure:
───────────────────────
{
    "symbol": "EURUSD",
    "lot": dynamic_by_balance,      # (AccountBalance × 0.0025) / (SL × PointValue)
    "TP": 500,
    "SL": 250,
    "ATR": 0,                       # Not used in S1
    "ma_position": 0,
    "currently_open": False,
    "verdict_GPT": "",
    "manual_position": ""
}

Position Sizing Formula:
────────────────────────
RiskAmount = AccountBalance × 0.0025
LotSize = RiskAmount / (SL × PointValue)
Example: $100,000 account, SL = 250 points → Lot = 0.10


┌──────────────────────────────────────────────────────────────────────────┐
│ S2: SEQUENTIAL MULTI-PAIR EXPANSION                                     │
└──────────────────────────────────────────────────────────────────────────┘

GOAL: Test pair diversification under static sizing

RISK METHOD: Static, same as S1 (for direct comparison)

Risk Parameters:
────────────────
RiskPerTrade = 0.25%
TP = 500 points
SL = 250 points
RewardToRisk = 2:1

Execution Logic:
────────────────
- Opens new pair when primary pair is blocked (alternative finder)
- Keeps multiple active trades per currency (up to 2)
- Allows EURUSD + EURGBP simultaneously
- No position closing on new signals

Market Data Required:
─────────────────────
None (static sizing)

EA Variables Structure:
───────────────────────
{
    "symbol": "EURUSD",
    "lot": dynamic_by_balance,      # Same as S1
    "TP": 500,
    "SL": 250,
    "ATR": 0,                       # Not used in S2
    "ma_position": 0,
    "currently_open": False,
    "verdict_GPT": "",
    "manual_position": ""
}

Position Sizing Formula:
────────────────────────
Same as S1: LotSize = (AccountBalance × 0.0025) / (SL × PointValue)


┌──────────────────────────────────────────────────────────────────────────┐
│ S3: ROLLING CURRENCY MODE                                                │
└──────────────────────────────────────────────────────────────────────────┘

GOAL: Track one position per currency, close/reverse on new sentiment

RISK METHOD: Static 2:1 (slightly higher weight for agility)

Risk Parameters:
────────────────
RiskPerTrade = 0.30%                # Increased 20% vs S1/S2 for rolling agility
TP = 500 points
SL = 250 points
RewardToRisk = 2:1

Execution Logic:
────────────────
- Always exactly 1 trade per currency (EUR, GBP, USD, etc.)
- Close existing position immediately on opposite signal
- Reverse: EURUSD BUY → close → EURJPY SELL
- Currency-level sentiment tracking

Market Data Required:
─────────────────────
None (static sizing)

EA Variables Structure:
───────────────────────
{
    "symbol": "EURUSD",
    "lot": dynamic_by_balance,      # (AccountBalance × 0.0030) / (SL × PointValue)
    "TP": 500,
    "SL": 250,
    "ATR": 0,                       # Not used in S3
    "ma_position": 0,
    "currently_open": currency_locked,  # Tracks if currency has active position
    "verdict_GPT": "",
    "manual_position": ""
}

Position Sizing Formula:
────────────────────────
RiskAmount = AccountBalance × 0.0030
LotSize = RiskAmount / (SL × PointValue)
Example: $100,000 account, SL = 250 points → Lot = 0.12


┌──────────────────────────────────────────────────────────────────────────┐
│ S4: TIMED PORTFOLIO MODE                                                 │
└──────────────────────────────────────────────────────────────────────────┘

GOAL: Test long-hold efficiency with volatility-adjusted sizing

RISK METHOD: ATR dynamic sizing (2:1 structure)

Risk Parameters:
────────────────
ATR = 14-period ATR on 30-minute timeframe
SL = 1.0 × ATR
TP = 2.0 × ATR
RiskPerTrade = 0.25%
RewardToRisk = 2:1 (maintained via ATR multipliers)

Execution Logic:
────────────────
- One trade per pair per week (locks pair after first trade)
- Up to 4 positions per currency (diversified across pairs)
- Weekly reset: clears locked pairs Monday 00:00
- Uses ATR to reflect real market volatility

Market Data Required:
─────────────────────
ATR(14, 30-minute timeframe) - updated by MT5 client

EA Variables Structure:
───────────────────────
{
    "symbol": "EURUSD",
    "lot": dynamic_by_ATR,          # (AccountBalance × 0.0025) / (SL × PointValue)
    "TP": 2 × ATR,                  # Dynamic based on current volatility
    "SL": 1 × ATR,                  # Dynamic based on current volatility
    "ATR": ATR(30m),                # Sent from MT5 client
    "ma_position": 0,
    "currently_open": False,
    "verdict_GPT": "",
    "manual_position": ""
}

Position Sizing Formula:
────────────────────────
ATR_value = Get from MT5 (e.g., 45 pips for EURUSD)
SL = 1.0 × ATR_value = 45 pips
TP = 2.0 × ATR_value = 90 pips
RiskAmount = AccountBalance × 0.0025
LotSize = RiskAmount / (SL × PointValue)

Example: $100,000 account, ATR = 45 pips
- SL = 45 pips
- TP = 90 pips
- Lot = ($100,000 × 0.0025) / (45 × $10) = 0.056 lots


┌──────────────────────────────────────────────────────────────────────────┐
│ S5: ADAPTIVE HYBRID MODE                                                 │
└──────────────────────────────────────────────────────────────────────────┘

GOAL: Test multi-event stacking with adaptive scaling

RISK METHOD: Stacked ATR sizing (scales on agreement)

Risk Parameters:
────────────────
BaseRisk = 0.25%                    # First position for currency
AddRisk = 0.15%                     # Additional position on confirming event
MaxRiskPerCurrency = 0.50%          # Total cap per currency (2 positions max)
SL = 1.0 × ATR
TP = 2.0 × ATR
RewardToRisk = 2:1 (via ATR multipliers)

Execution Logic:
────────────────
- Opens first position at 0.25% risk
- Adds second position at 0.15% risk if new event agrees
- Reverses all positions on sentiment flip
- Combines S3's rolling logic with S4's volatility adaptation

Market Data Required:
─────────────────────
ATR(14, 30-minute timeframe) - updated by MT5 client

EA Variables Structure:
───────────────────────
{
    "symbol": "EURUSD",
    "lot": scaled_by_ATR_and_alignment,  # Changes based on position count
    "TP": 2 × ATR,                       # Dynamic
    "SL": 1 × ATR,                       # Dynamic
    "ATR": ATR(30m),                     # Sent from MT5
    "ma_position": 0,
    "currently_open": currency_locked,   # Tracks sentiment + position count
    "verdict_GPT": "",
    "manual_position": ""
}

Position Sizing Formula:
────────────────────────
Position 1 (First Event):
- RiskAmount = AccountBalance × 0.0025
- LotSize_1 = RiskAmount / (SL × PointValue)

Position 2 (Confirming Event):
- RiskAmount = AccountBalance × 0.0015
- LotSize_2 = RiskAmount / (SL × PointValue)

Example: $100,000 account, ATR = 45 pips
Position 1: Lot = 0.056
Position 2: Lot = 0.033
Total Risk: 0.40% (within 0.50% cap)


PERFORMANCE METRICS (SAME FOR ALL STRATEGIES)
================================================================================

Per-Trade Metrics:
──────────────────
- Win Rate (%)                  # News signal accuracy
- Avg Return (%)                # Expected per-trade gain
- P/L (pips)                    # Raw profit/loss
- Duration (minutes)            # Hold time
- Entry ATR (S4/S5 only)        # Volatility at entry
- Surprise Strength             # (Actual - Forecast) / Forecast
- Close Type                    # TP, SL, Reversal, WeekEnd, Manual

Aggregate Metrics:
──────────────────
- Total Return (%)              # Strategy profitability
- Max Drawdown (%)              # Recovery depth before +1%
- Profit Factor                 # Gross Profit / Gross Loss
- Sharpe Ratio                  # Avg Return / Std Dev
- TP Hit % / SL Hit %           # Precision of direction
- Avg Duration (min)            # Holding time distribution
- Currency Exposure %           # Risk distribution by currency
- Pair Utilization %            # Which pairs used most

Risk Metrics:
─────────────
- Max Concurrent Risk (%)       # Highest total exposure
- Avg Concurrent Risk (%)       # Typical exposure level
- Currency Concentration (%)    # Risk per currency distribution
- Weekly Drawdown Timeline      # Recovery path to +1%


STRATEGY COMPARISON TABLE
================================================================================

┌──────────┬──────────────┬──────────┬───────┬─────────────┬────────────────┬─────────────────────────┐
│ Strategy │ Sizing Model │ Risk %   │ TP:SL │ Market Data │ Weekly Stop    │ Notes                   │
├──────────┼──────────────┼──────────┼───────┼─────────────┼────────────────┼─────────────────────────┤
│ S1       │ Static       │ 0.25     │ 2:1   │ None        │ Stop after +1% │ Pure signal accuracy    │
│ S2       │ Static       │ 0.25     │ 2:1   │ None        │ Stop after +1% │ Diversification test    │
│ S3       │ Static       │ 0.30     │ 2:1   │ None        │ Stop after +1% │ Rolling sentiment model │
│ S4       │ ATR Dynamic  │ 0.25     │ 2:1   │ ATR(30m)    │ Stop after +1% │ Long-hold volatility    │
│ S5       │ ATR + Scaled │ 0.25→0.50│ 2:1   │ ATR(30m)    │ Stop after +1% │ Adaptive aggregation    │
└──────────┴──────────────┴──────────┴───────┴─────────────┴────────────────┴─────────────────────────┘


ENHANCED EA VARIABLES STRUCTURE (OPTIONAL)
================================================================================

Additional tracking fields for deeper analysis:

{
    "symbol": "EURUSD",
    "lot": dynamic,
    "TP": 500 or 2×ATR,
    "SL": 250 or 1×ATR,
    "ATR": 0 or ATR(30m),
    "ma_position": 0,
    "currently_open": False,
    "verdict_GPT": "",
    "manual_position": "",
    
    # Analytics Enhancement
    "weekly_gain": 0.0,             # Running profit this week
    "weekly_drawdown": 0.0,         # Max DD this week
    "atr_value": 0.0,               # Current ATR value
    "risk_percent": 0.25,           # Risk % for this position
    "reward_to_risk": 2.0,          # TP/SL ratio
    "entry_ATR": 0.0,               # ATR at trade entry (S4/S5)
    "event_strength": 0.0,          # Surprise strength at entry
    "position_type": "AUTO",        # AUTO vs MANUAL (test positions)
    "position_count": 1,            # 1st, 2nd position for currency (S5)
    "sentiment_agreement": True     # Does this agree with prior signal? (S5)
}


POSITION SIZING FORMULAS SUMMARY
================================================================================

S1 (Static):
────────────
Lot = (AccountBalance × 0.0025) / (250 × PointValue)

S2 (Static):
────────────
Lot = (AccountBalance × 0.0025) / (250 × PointValue)

S3 (Static):
────────────
Lot = (AccountBalance × 0.0030) / (250 × PointValue)

S4 (ATR Dynamic):
─────────────────
ATR = Get from MT5
SL = 1.0 × ATR
TP = 2.0 × ATR
Lot = (AccountBalance × 0.0025) / (SL × PointValue)

S5 (ATR + Scaled):
──────────────────
Position 1:
ATR = Get from MT5
SL = 1.0 × ATR
TP = 2.0 × ATR
Lot = (AccountBalance × 0.0025) / (SL × PointValue)

Position 2 (if sentiment agrees):
SL = 1.0 × ATR
TP = 2.0 × ATR
Lot = (AccountBalance × 0.0015) / (SL × PointValue)


WEEKLY TARGET LOGIC
================================================================================

All strategies continue trading until weekly +1% profit target reached:

1. Track cumulative return for the week
2. When cumulative return >= +1.0%:
   - Stop opening new positions
   - Allow existing positions to close naturally (TP/SL)
   - Log "Weekly Target Reached" event
3. Monday 00:00: Reset weekly counter, resume trading

No Loss Cap:
────────────
- If cumulative return goes negative (e.g., -2.5%), continue trading
- Capture full drawdown behavior for resilience analysis
- Only stop when +1% profit achieved
- This tests strategy recovery capability


MT5 CLIENT REQUIREMENTS
================================================================================

Data Package to Send to Python Server:
───────────────────────────────────────
{
    "account_balance": 100000.00,
    "symbols": {
        "EURUSD": {
            "ATR": 45.0,                    # 14-period ATR on 30-minute chart
            "current_price": 1.0850,
            "spread": 1.5
        },
        "GBPUSD": {
            "ATR": 52.0,
            "current_price": 1.2650,
            "spread": 2.0
        }
        # ... all pairs in _Symbols_
    },
    "open_positions": [
        {
            "ticket": 12345,
            "symbol": "EURUSD",
            "action": "BUY",
            "entry_price": 1.0850,
            "current_price": 1.0865,
            "unrealized_pnl": 15.0,
            "mae": -8.0,                    # Max Adverse Excursion
            "mfe": 28.0                     # Max Favorable Excursion
        }
    ]
}

Update Frequency:
─────────────────
- Account balance: Every heartbeat (30 seconds)
- ATR values: Every 30 minutes (when new bar forms)
- Open positions: Every heartbeat (track MAE/MFE)


RISK LIMITS ENFORCEMENT
================================================================================

Currency Exposure Limit (1.0%):
────────────────────────────────
Sum of all open EUR positions risk <= 1.0% of account
Example: EURUSD (0.25%) + EURGBP (0.25%) = 0.50% ✅

Total Exposure Limit (2.0%):
────────────────────────────
Sum of ALL open positions risk <= 2.0% of account
Example: EUR (0.50%) + USD (0.40%) + GBP (0.30%) = 1.20% ✅

Position Limits:
────────────────
S1: 1 position per currency
S2: 2 positions per currency (different pairs)
S3: 1 position per currency (rolling)
S4: 4 positions per currency (different pairs, weekly locked)
S5: 2 positions per currency (scaled on agreement)


IMPLEMENTATION CHECKLIST
================================================================================

✅ Globals.py:
- accBalance = 100000
- lot_size_percentage = 0.0025
- ATR field added to _Symbols_

⚠️ To Implement:
- S4: Per-pair limit logic (news_filter_maxTradePerPair)
- S4: Weekly tracking (_PairsTraded_ThisWeek_)
- S4: Weekly reset function
- S3: Close command system
- S3: _CurrencyPositions_ tracking
- S3: Reversal detection logic
- S5: _CurrencySentiment_ tracking
- S5: Position scaling logic
- S5: Conflict handling

⚠️ MT5 Client:
- Send account_balance on every heartbeat
- Calculate and send ATR(14, 30m) for all pairs every 30 minutes
- Track and send MAE/MFE for open positions

⚠️ Logging:
- Capture all 28 fields per trade (see .newsStrategyStatCapture.txt)
- Log to trades_log.csv on position close
- Track weekly cumulative return
- Detect +1% weekly target achievement


TESTING EXECUTION PLAN
================================================================================

Week 1-2: S1, S2 (Static Sizing Baseline)
──────────────────────────────────────────
- Establish baseline performance with static sizing
- Validate alternative pair finder (S2)
- Collect raw signal accuracy data

Week 2: Implement S4
────────────────────
- Add per-pair limits logic
- Implement weekly tracking and reset
- Begin ATR-based sizing testing

Week 3: Implement S3
────────────────────
- Add close command system
- Implement reversal logic
- Test rolling sentiment vs holding

Week 3-4: Implement S5
──────────────────────
- Add sentiment aggregation
- Implement position scaling
- Test adaptive hybrid approach

Final Week: All 5 Running
─────────────────────────
- Parallel execution of S1-S5
- Full dataset collection
- Comparative analysis


KEY INSIGHT
================================================================================
By removing the weekly loss cap and only stopping at +1% profit target,
we capture TRUE recovery behavior:

❌ With Loss Cap: Strategy stopped at -2% → never shows if it could recover
✅ Without Loss Cap: Strategy hits -2.5%, recovers to +1% → proves resilience

This data reveals which strategies handle drawdowns best and have strongest
recovery mechanics - critical for live trading confidence.

All strategies maintain 2:1 reward-to-risk for fair comparison, with S3 using
slightly higher risk (0.30%) to reflect its agility advantage from rolling logic.

================================================================================
END OF DOCUMENT
================================================================================
