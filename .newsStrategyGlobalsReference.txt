================================================================================
NEWS TRADING STRATEGY - GLOBAL VARIABLES REFERENCE
================================================================================
Created: November 7, 2025
Purpose: Complete reference of all global variables added to Globals.py for
         S1-S5 strategy testing, data capture, and MT5 communication
================================================================================

SECTION 1: ACCOUNT & POSITION SIZING VARIABLES
================================================================================

accBalance = 100000
    Type: float
    Purpose: Current account balance (updated by MT5 client)
    Used By: All strategies for dynamic lot sizing
    Updated: Every MT5 heartbeat (30 seconds)

lot_size_percentage = 0.0025
    Type: float
    Purpose: Base risk percentage (0.25% of account balance)
    Used By: S1, S2, S4 (S3 uses 0.30%, S5 uses 0.25%-0.50%)
    Formula: LotSize = (accBalance × lot_size_percentage) / (SL × point_value)

weekly_profit_target = 1.0
    Type: float
    Purpose: Weekly cumulative return target (1.0% = 0.01)
    Used By: All strategies (stop opening new positions when reached)
    Reset: Every Monday 00:00

weekly_cumulative_return = 0.0
    Type: float
    Purpose: Running profit/loss for current week
    Updated: Every trade close
    Reset: Every Monday 00:00

weekly_target_reached = False
    Type: bool
    Purpose: Flag to stop opening new positions when target hit
    Set: When weekly_cumulative_return >= weekly_profit_target
    Reset: Every Monday 00:00


SECTION 2: STRATEGY SELECTION & CONFIGURATION
================================================================================

news_strategy = 2
    Type: int
    Purpose: Active strategy selector (1=S1, 2=S2, 3=S3, 4=S4, 5=S5)
    Default: 2 (S2 - Multi-Pair with Alternatives)
    Change: Update this to switch strategies

strategy_risk = {1: 0.0025, 2: 0.0025, 3: 0.0030, 4: 0.0025, 5: 0.0025}
    Type: dict[int → float]
    Purpose: Risk percentage per strategy
    Structure: {strategy_id: risk_percent}
    Note: S3 uses 0.30% (higher for rolling agility)

strategy_tp_sl = {
    1: {"TP": 500, "SL": 250},    # S1: Static
    2: {"TP": 500, "SL": 250},    # S2: Static
    3: {"TP": 500, "SL": 250},    # S3: Static
    4: {"TP": 0, "SL": 0},        # S4: ATR-based (0 = use ATR)
    5: {"TP": 0, "SL": 0},        # S5: ATR-based (0 = use ATR)
}
    Type: dict[int → dict]
    Purpose: TP/SL configuration per strategy
    Structure: {strategy_id: {"TP": points, "SL": points}}
    Note: 0 = use ATR-based calculation (2×ATR TP, 1×ATR SL)


SECTION 3: S3 (ROLLING MODE) TRACKING
================================================================================

_CurrencyPositions_ = {}
    Type: dict[str → dict]
    Purpose: Track ONE active position per currency for S3 reversal logic
    Structure: {
        "EUR": {
            "pair": "EURUSD",
            "action": "BUY",
            "ticket": 12345,
            "TID": "TID_5_1",
            "NID": 5,
            "entry_time": "2025-11-07T08:30:03"
        }
    }
    Used By: S3 only
    Logic: When new EUR signal with opposite direction arrives:
           - Close existing position
           - Clear _CurrencyPositions_["EUR"]
           - Open new position in new direction

news_filter_rollingMode = False
    Type: bool
    Purpose: Enable rolling mode (S3 only)
    Set: news_strategy == 3
    Logic: When True, activates reversal detection in STEP 7


SECTION 4: S4 (TIMED PORTFOLIO) TRACKING
================================================================================

_PairsTraded_ThisWeek_ = {}
    Type: dict[str → bool]
    Purpose: Track which pairs already traded this week (S4 weekly lock)
    Structure: {"EURUSD": True, "GBPUSD": False, "USDJPY": True}
    Used By: S4 only
    Logic: After first trade on pair, set to True → block further trades
    Reset: Every Monday 00:00

news_filter_weeklyFirstOnly = False
    Type: bool
    Purpose: Enable weekly first-only mode (S4 only)
    Set: news_strategy == 4
    Logic: When True, locks pair after first trade until weekly reset

last_weekly_reset = None
    Type: datetime
    Purpose: Track last weekly reset timestamp to detect Monday boundary
    Updated: Every Monday 00:00
    Logic: Check if datetime.now().weekday() == 0 and current_date > last_weekly_reset


SECTION 5: S5 (ADAPTIVE HYBRID) TRACKING
================================================================================

_CurrencySentiment_ = {}
    Type: dict[str → dict]
    Purpose: Track sentiment consensus and confidence per currency (S5)
    Structure: {
        "EUR": {
            "direction": "BULL",                    # BULL or BEAR
            "confidence": 2,                         # Number of agreeing events
            "events": [5, 7],                        # NIDs that contributed
            "positions": ["TID_5_1", "TID_7_1"],    # Active trades
            "last_update": "2025-11-07T10:30:00"    # When sentiment changed
        }
    }
    Used By: S5 only
    Logic: 
        - First event sets direction + confidence=1
        - Agreeing event increments confidence, adds position
        - Conflicting event triggers conflict handling

news_filter_allowScaling = False
    Type: bool
    Purpose: Enable position scaling (S5 only)
    Set: news_strategy == 5
    Logic: When True, allows multiple positions per currency when events agree

news_filter_maxScalePositions = 2
    Type: int
    Purpose: Max positions to stack per currency (S5)
    Default: 2 (base + 1 scaled)
    Logic: Prevents unlimited stacking

news_filter_scalingFactor = 0.6
    Type: float
    Purpose: Scaling factor for additional positions (S5)
    Default: 0.6 (60% of previous position)
    Logic: Position 1: 0.25%, Position 2: 0.25% × 0.6 = 0.15%

news_filter_conflictHandling = "reverse"
    Type: str
    Purpose: How to handle conflicting signals (S5)
    Options: "ignore" | "reverse" | "reduce"
    Default: "reverse" (like S3)
    Logic:
        - "ignore": Keep existing positions, skip conflicting signal
        - "reverse": Close all existing, open new position opposite direction
        - "reduce": Reduce position size, wait for tie-breaker


SECTION 6: DATA CAPTURE VARIABLES
================================================================================

data_capture_enabled = True
    Type: bool
    Purpose: Master switch for CSV logging
    Default: True
    Set False: Disables all CSV writing (for testing without logging)

csv_file_path = None
    Type: str
    Purpose: Full path to current session CSV log
    Format: "trades_log_20251107_083000.csv"
    Set: During initialization (session_start_time)
    Example: "C:/News_Analyzer/trades_log_20251107_083000.csv"

_TradeRecords_ = []
    Type: list[dict]
    Purpose: Temporary buffer for trade records before CSV write
    Structure: List of dicts with 28 fields per trade
    Cleared: After writing to CSV (batch write)

session_start_time = None
    Type: datetime
    Purpose: Timestamp when EA started (for CSV filename)
    Set: During initialize_news_forecasts()
    Format: datetime.datetime(2025, 11, 7, 8, 30, 0)


SECTION 7: _Symbols_ DICTIONARY - ENHANCED FIELDS
================================================================================

All pairs now include these additional fields:

ATR = 0
    Type: float
    Purpose: 14-period ATR on 30-minute chart (updated by MT5)
    Used By: S4, S5 for dynamic TP/SL calculation
    Formula: TP = 2 × ATR, SL = 1 × ATR
    Updated: Every 30 minutes (when new bar forms)

current_price = 0.0
    Type: float
    Purpose: Current market price (updated by MT5)
    Used By: Spread calculation, volatility tracking
    Updated: Every heartbeat (30 seconds)

spread = 0.0
    Type: float
    Purpose: Current spread in pips (updated by MT5)
    Used By: Execution quality analysis
    Updated: Every heartbeat (30 seconds)

point_value = 10.0
    Type: float
    Purpose: Dollar value per pip (for lot sizing calculation)
    Default: 10.0 for most pairs (varies by pair)
    Examples:
        - EURUSD: 10.0
        - USDJPY: 9.0
        - EURGBP: 12.5
        - EURNZD: 6.5

weekly_gain = 0.0
    Type: float
    Purpose: Running profit this week for this pair
    Updated: Every trade close on this pair
    Reset: Every Monday 00:00

weekly_drawdown = 0.0
    Type: float
    Purpose: Max drawdown this week for this pair
    Updated: Every trade close on this pair
    Reset: Every Monday 00:00

traded_this_week = False
    Type: bool
    Purpose: S4 weekly lock flag for this pair
    Set: After first trade on pair this week (S4 only)
    Reset: Every Monday 00:00


SECTION 8: _Trades_ DICTIONARY - ENHANCED FIELDS (28 TOTAL)
================================================================================

All trades now include these 28 fields for data capture:

EXISTING FIELDS (12):
---------------------
TID, client_id, symbol, action, volume, tp, sl, comment, status, 
createdAt, updatedAt, NID, ticket

NEW FIELDS (16):
----------------
strategy = "S2"
    Type: str
    Purpose: Which strategy opened this trade (S1, S2, S3, S4, S5)
    Set: During trade creation in STEP 7

currency = "EUR"
    Type: str
    Purpose: Primary affected currency (EUR, USD, GBP, etc.)
    Set: From _Currencies_ event data

event_type = "CPI"
    Type: str
    Purpose: News category (CPI, GDP, Unemployment, NFP, Retail Sales, etc.)
    Set: Extracted from _Currencies_ event name

event_time = "2025-11-07T08:30:00"
    Type: str (ISO format)
    Purpose: News release timestamp
    Set: From _Currencies_ event data

entry_time = None
    Type: str (ISO format)
    Purpose: When trade actually opened (from MT5 response)
    Set: MT5 returns open_time after execution

exit_time = None
    Type: str (ISO format)
    Purpose: When trade closed (from MT5 response)
    Set: MT5 returns close_time when position closes

entry_price = 0.0
    Type: float
    Purpose: Actual entry price (from MT5)
    Set: MT5 returns entry_price after execution

exit_price = 0.0
    Type: float
    Purpose: Actual exit price (from MT5)
    Set: MT5 returns exit_price when position closes

duration_min = 0
    Type: int
    Purpose: Hold time in minutes
    Calculated: (exit_time - entry_time).total_seconds() / 60

reaction_delay_sec = 0.0
    Type: float
    Purpose: Execution latency (entry_time - event_time)
    Calculated: (entry_time - event_time).total_seconds()

pl_pips = 0.0
    Type: float
    Purpose: Profit/loss in pips
    Calculated: abs(exit_price - entry_price) × 10000 (for 4-digit pairs)
    Sign: Positive for win, negative for loss

return_pct = 0.0
    Type: float
    Purpose: % return on account balance
    Calculated: (pl_pips × volume × point_value) / accBalance × 100

result = ""
    Type: str
    Purpose: Trade outcome classification
    Values: "WIN" | "LOSS" | "BREAKEVEN"
    Logic: pl_pips > 0 → WIN, pl_pips < 0 → LOSS, pl_pips == 0 → BREAKEVEN

sl_hit = False
    Type: bool
    Purpose: True if closed via stop-loss
    Logic: abs(exit_price - entry_price) ≈ sl_distance

tp_hit = False
    Type: bool
    Purpose: True if closed via take-profit
    Logic: abs(exit_price - entry_price) ≈ tp_distance

close_type = ""
    Type: str
    Purpose: How trade closed
    Values: "TP" | "SL" | "Reversal" | "WeekEnd" | "Manual"
    Logic:
        - tp_hit = True → "TP"
        - sl_hit = True → "SL"
        - S3/S5 closes for reversal → "Reversal"
        - Friday close logic → "WeekEnd"
        - Manual intervention → "Manual"

surprise_strength = 0.0
    Type: float
    Purpose: News deviation from forecast
    Calculated: (actual - forecast) / forecast
    Example: Forecast 2.1%, Actual 2.8% → (2.8 - 2.1) / 2.1 = +0.33 (+33%)

market_volatility = 0.0
    Type: float
    Purpose: High - Low range during trade (pips)
    Calculated: (high - low) × 10000 (from MT5 OHLC during trade)

mae = 0.0
    Type: float
    Purpose: Max Adverse Excursion (largest unrealized loss during trade)
    Example: Entry 1.0850, Low 1.0835 → MAE = -15 pips
    Tracked: MT5 sends running MAE with position updates

mfe = 0.0
    Type: float
    Purpose: Max Favorable Excursion (largest unrealized profit before close)
    Example: Entry 1.0850, High 1.0890, Exit 1.0865 → MFE = +40 pips
    Tracked: MT5 sends running MFE with position updates

entry_atr = 0.0
    Type: float
    Purpose: ATR value at trade entry (S4/S5 only)
    Set: Copy _Symbols_[pair]["ATR"] at trade creation
    Used: For analyzing if ATR-based sizing was optimal

position_count = 1
    Type: int
    Purpose: 1st, 2nd position for this currency (S5 only)
    Logic: _CurrencySentiment_[currency]["confidence"]
    Example: First EUR position = 1, Second agreeing EUR position = 2

sentiment_agreement = True
    Type: bool
    Purpose: Does this agree with prior signal? (S5 only)
    Logic:
        - First position for currency → True
        - Agreeing event → True
        - Conflicting event → False


SECTION 9: MT5 DATA PACKAGE STRUCTURE
================================================================================

MT5 client sends this JSON structure every 30 seconds (heartbeat):

{
    "account_balance": 100000.00,
    "symbols": {
        "EURUSD": {
            "ATR": 45.0,                    # 14-period ATR (30m chart)
            "current_price": 1.0850,
            "spread": 1.5,
            "high": 1.0870,                 # Session high (for volatility)
            "low": 1.0835                   # Session low (for volatility)
        }
        # ... all pairs in _Symbols_
    },
    "open_positions": [
        {
            "ticket": 12345,
            "symbol": "EURUSD",
            "action": "BUY",
            "entry_price": 1.0850,
            "current_price": 1.0865,
            "unrealized_pnl": 15.0,         # In pips
            "mae": -8.0,                    # Max Adverse Excursion
            "mfe": 28.0,                    # Max Favorable Excursion
            "open_time": "2025-11-07T08:30:03",
            "TID": "TID_5_1"               # Link to _Trades_
        }
    ],
    "closed_positions": [
        {
            "ticket": 12345,
            "symbol": "EURUSD",
            "action": "BUY",
            "entry_price": 1.0850,
            "exit_price": 1.0873,
            "pl_pips": 23.0,
            "open_time": "2025-11-07T08:30:03",
            "close_time": "2025-11-07T14:45:12",
            "close_reason": "TP",           # TP | SL | Manual
            "TID": "TID_5_1"
        }
    ]
}

VARIABLES TO STORE THIS DATA:

last_mt5_heartbeat = None
    Type: datetime
    Purpose: Track last MT5 communication timestamp
    Updated: Every heartbeat receipt
    Logic: If datetime.now() - last_mt5_heartbeat > 60 seconds → mt5_connected = False

mt5_connected = False
    Type: bool
    Purpose: MT5 connection status flag
    Set: True when heartbeat received within last 60 seconds
    Logic: Prevents trade execution when MT5 disconnected


SECTION 10: CSV LOGGING SCHEMA (28 COLUMNS)
================================================================================

trades_log.csv format:

Column 1: TID                    (str)      "TID_5_1"
Column 2: Strategy               (str)      "S2"
Column 3: Currency               (str)      "EUR"
Column 4: Pair                   (str)      "EURUSD"
Column 5: Direction              (str)      "BUY"
Column 6: EventType              (str)      "CPI"
Column 7: EventTime              (str)      "2025-11-07 08:30:00"
Column 8: EntryTime              (str)      "2025-11-07 08:30:03"
Column 9: ExitTime               (str)      "2025-11-07 14:45:12"
Column 10: EntryPrice            (float)    1.0850
Column 11: ExitPrice             (float)    1.0873
Column 12: Duration              (int)      375 (minutes)
Column 13: PL_Pips               (float)    +23.0
Column 14: Return_Pct            (float)    +0.46
Column 15: Result                (str)      "WIN"
Column 16: LotSize               (float)    0.50
Column 17: SL_Hit                (bool)     False
Column 18: TP_Hit                (bool)     True
Column 19: CloseType             (str)      "TP"
Column 20: SurpriseStrength      (float)    +0.33
Column 21: ReactionDelay         (float)    3.2 (seconds)
Column 22: Volatility            (float)    45.0 (pips)
Column 23: MAE                   (float)    -8.0 (pips)
Column 24: MFE                   (float)    +28.0 (pips)
Column 25: NID                   (int)      5
Column 26: EntryATR              (float)    45.0 (S4/S5 only)
Column 27: PositionCount         (int)      1 (S5 only)
Column 28: SentimentAgreement    (bool)     True (S5 only)


SECTION 11: IMPLEMENTATION CHECKLIST
================================================================================

✅ COMPLETED (Already in Globals.py):
--------------------------------------
- accBalance, lot_size_percentage
- weekly_profit_target, weekly_cumulative_return, weekly_target_reached
- news_strategy, strategy_risk, strategy_tp_sl
- _CurrencyPositions_, news_filter_rollingMode
- _PairsTraded_ThisWeek_, news_filter_weeklyFirstOnly, last_weekly_reset
- _CurrencySentiment_, news_filter_allowScaling, news_filter_maxScalePositions
- news_filter_scalingFactor, news_filter_conflictHandling
- data_capture_enabled, csv_file_path, _TradeRecords_, session_start_time
- last_mt5_heartbeat, mt5_connected
- _Symbols_ updated with: ATR, current_price, spread, point_value, 
  weekly_gain, weekly_drawdown, traded_this_week
- _Trades_ updated with 28 fields for data capture

⚠️ TO IMPLEMENT:
----------------
1. CSV Writer Function (trades_log.py)
   - write_trade_record(trade_data) function
   - Initialize CSV with 28-column headers
   - Append row on trade close

2. Surprise Strength Calculation (News.py)
   - Calculate: (actual - forecast) / forecast
   - Store in _Trades_[TID]["surprise_strength"]
   - Add to trade record before CSV write

3. MT5 Communication Update (Server.py)
   - Add /heartbeat endpoint to receive MT5 data package
   - Update accBalance, _Symbols_[pair]["ATR"], etc.
   - Process closed_positions and write to CSV

4. Weekly Reset Function (News.py or Functions.py)
   - Detect Monday 00:00 boundary
   - Reset: weekly_cumulative_return, weekly_target_reached
   - Reset: _PairsTraded_ThisWeek_, _Symbols_[pair]["traded_this_week"]
   - Reset: _Symbols_[pair]["weekly_gain"], _Symbols_[pair]["weekly_drawdown"]

5. Strategy-Specific Logic:
   - S3: Reversal detection and close command
   - S4: Per-pair limit enforcement
   - S5: Sentiment aggregation and scaling

6. Position Sizing Functions:
   - calculate_lot_size(symbol, strategy) function
   - Static sizing for S1/S2/S3
   - ATR-based sizing for S4/S5
   - Scaled sizing for S5 second position


SECTION 12: VARIABLE NAMING CONVENTIONS
================================================================================

Dictionaries: _PascalCase_
    Examples: _Symbols_, _Currencies_, _Trades_, _CurrencyPositions_
    Pattern: Underscore prefix/suffix, internal PascalCase

Filters: news_filter_camelCase
    Examples: news_filter_maxTradePerCurrency, news_filter_rollingMode
    Pattern: news_filter_ prefix, then camelCase

Trackers: snake_case
    Examples: weekly_cumulative_return, last_mt5_heartbeat
    Pattern: Lowercase with underscores

Constants: UPPER_CASE
    Examples: SERVER_HOST, SERVER_PORT
    Pattern: All uppercase with underscores

Flags: snake_case with _enabled/_reached/_connected suffix
    Examples: data_capture_enabled, weekly_target_reached, mt5_connected
    Pattern: Descriptive name + status suffix


SECTION 13: QUICK REFERENCE - VARIABLES BY STRATEGY
================================================================================

S1 (Sequential Same-Pair):
--------------------------
- news_strategy = 1
- strategy_risk[1] = 0.0025
- strategy_tp_sl[1] = {"TP": 500, "SL": 250}
- No special tracking dictionaries needed

S2 (Multi-Pair with Alternatives):
-----------------------------------
- news_strategy = 2
- strategy_risk[2] = 0.0025
- strategy_tp_sl[2] = {"TP": 500, "SL": 250}
- Uses existing alternative finder logic

S3 (Rolling Currency Mode):
----------------------------
- news_strategy = 3
- strategy_risk[3] = 0.0030 (higher for agility)
- strategy_tp_sl[3] = {"TP": 500, "SL": 250}
- news_filter_rollingMode = True
- _CurrencyPositions_ = {currency → position_data}

S4 (Timed Portfolio Mode):
---------------------------
- news_strategy = 4
- strategy_risk[4] = 0.0025
- strategy_tp_sl[4] = {"TP": 0, "SL": 0} (ATR-based)
- news_filter_weeklyFirstOnly = True
- _PairsTraded_ThisWeek_ = {pair → bool}
- _Symbols_[pair]["traded_this_week"]
- _Symbols_[pair]["ATR"] (from MT5)

S5 (Adaptive Hybrid):
---------------------
- news_strategy = 5
- strategy_risk[5] = 0.0025 (scales to 0.0040 with agreement)
- strategy_tp_sl[5] = {"TP": 0, "SL": 0} (ATR-based)
- news_filter_allowScaling = True
- news_filter_maxScalePositions = 2
- news_filter_scalingFactor = 0.6
- news_filter_conflictHandling = "reverse"
- _CurrencySentiment_ = {currency → sentiment_data}
- _Symbols_[pair]["ATR"] (from MT5)


SECTION 14: USAGE EXAMPLES
================================================================================

Example 1: Calculate Lot Size (S1/S2/S3)
-----------------------------------------
risk_pct = strategy_risk[news_strategy]
sl_pips = strategy_tp_sl[news_strategy]["SL"]
point_val = _Symbols_["EURUSD"]["point_value"]

risk_amount = accBalance * risk_pct
lot_size = risk_amount / (sl_pips * point_val)
# Result: (100000 × 0.0025) / (250 × 10) = 0.10 lots

Example 2: Calculate ATR-Based TP/SL (S4/S5)
---------------------------------------------
atr = _Symbols_["EURUSD"]["ATR"]  # e.g., 45 pips
sl_pips = 1.0 * atr  # 45 pips
tp_pips = 2.0 * atr  # 90 pips

risk_pct = strategy_risk[news_strategy]
point_val = _Symbols_["EURUSD"]["point_value"]

risk_amount = accBalance * risk_pct
lot_size = risk_amount / (sl_pips * point_val)
# Result: (100000 × 0.0025) / (45 × 10) = 0.056 lots

Example 3: Check Weekly Target
-------------------------------
if weekly_cumulative_return >= weekly_profit_target:
    weekly_target_reached = True
    print("Weekly target reached! Stop opening new positions.")
    # Allow existing positions to close naturally

Example 4: S3 Reversal Detection
---------------------------------
currency = "EUR"
new_direction = "BEAR"

if currency in _CurrencyPositions_:
    existing_direction = _CurrencyPositions_[currency]["action"]  # "BUY"
    
    if (existing_direction == "BUY" and new_direction == "BEAR") or \
       (existing_direction == "SELL" and new_direction == "BULL"):
        # Reversal detected!
        old_ticket = _CurrencyPositions_[currency]["ticket"]
        send_close_command(old_ticket)
        del _CurrencyPositions_[currency]
        # Now open new position in opposite direction

Example 5: S4 Weekly Lock Check
--------------------------------
pair = "EURUSD"

if _Symbols_[pair]["traded_this_week"]:
    print(f"{pair} already traded this week, skip")
    return False

# First trade this week, proceed
_Symbols_[pair]["traded_this_week"] = True
_PairsTraded_ThisWeek_[pair] = True

Example 6: S5 Sentiment Aggregation
------------------------------------
currency = "EUR"
new_direction = "BULL"

if currency not in _CurrencySentiment_:
    # First event for EUR
    _CurrencySentiment_[currency] = {
        "direction": "BULL",
        "confidence": 1,
        "events": [5],
        "positions": ["TID_5_1"],
        "last_update": datetime.now().isoformat()
    }
else:
    # Check if agrees with existing sentiment
    if _CurrencySentiment_[currency]["direction"] == "BULL":
        # Agreement! Scale up
        _CurrencySentiment_[currency]["confidence"] += 1
        _CurrencySentiment_[currency]["events"].append(7)
        # Open second position with scaled lot size
    else:
        # Conflict! Handle according to news_filter_conflictHandling


================================================================================
END OF REFERENCE DOCUMENT
================================================================================

This document provides a complete reference for all global variables added to
Globals.py to support S1-S5 strategy testing, comprehensive data capture, and
MT5 communication. Use this as a lookup guide during implementation.

Next Steps:
1. Implement CSV writer function (trades_log.py)
2. Add surprise strength calculation in News.py
3. Create MT5 heartbeat endpoint in Server.py
4. Implement weekly reset logic
5. Add strategy-specific logic (S3/S4/S5)

