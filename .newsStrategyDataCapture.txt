================================================================================
NEWS TRADING STRATEGY - DATA CAPTURE & DISPLAY ARCHITECTURE
================================================================================
Purpose: Define where all captured data is displayed/stored during testing
Last Updated: November 7, 2025
================================================================================

OVERVIEW
================================================================================
This document maps every piece of captured data to its display location(s).
Data flows through multiple channels for different purposes:
- Real-time monitoring (text files)
- Historical analysis (CSV files)
- Live debugging (console output)

Architecture follows a hybrid approach:
✅ Text files for human-readable live monitoring
✅ CSV files for post-analysis and visualization
✅ Console output for immediate debugging


DATA DISPLAY LOCATIONS - COMPLETE MAP
================================================================================

┌──────────────────────────────────────────────────────────────────────────┐
│ 1. OUTPUT.TXT - LIVE CONSOLE OUTPUT                                     │
└──────────────────────────────────────────────────────────────────────────┘

File: Output.txt
Type: Plain text (append mode)
Purpose: Live debugging, execution flow tracking
Update Frequency: Continuous (every print statement)
Retention: Session-based (new session = new file or append)

Content:
--------
- All console print statements
- STEP 1-7 execution logs
- Trade execution confirmations
- Error messages and warnings
- API call results (GPT verdicts, actual data fetches)
- Alternative pair finder activity
- Risk filter rejections
- Currency/pair limit checks

Example Output:
---------------
[2025-11-07 08:30:03] STEP 7: Processing EUR CPI event (NID: 5)
[2025-11-07 08:30:04] GPT Verdict: BULL EUR
[2025-11-07 08:30:05] Creating trade: EURUSD BUY (TID_5_1)
[2025-11-07 08:30:05] Surprise Strength: +0.33 (Actual 2.8% vs Forecast 2.1%)
[2025-11-07 08:30:06] Trade queued successfully
[2025-11-07 08:30:10] MT5 Response: Ticket 12345 opened at 1.0850

Why This Matters:
-----------------
Real-time visibility into what's happening during execution. If something goes
wrong, you can trace the exact sequence of events. Essential for debugging.


┌──────────────────────────────────────────────────────────────────────────┐
│ 2. NEWS_DICTIONARIES.TXT - DICTIONARY SNAPSHOTS                         │
└──────────────────────────────────────────────────────────────────────────┘

File: news_dictionaries.txt
Type: Plain text (overwrite mode)
Purpose: Current state snapshot of all tracking dictionaries
Update Frequency: Every heartbeat (~30 seconds) or after significant events
Retention: Always shows LATEST state (no history)

Content:
--------
1. _Currencies_ Dictionary
   - All tracked news events
   - Forecast, actual, affect (BULL/BEAR/NEUTRAL)
   - NID, NID_Affect, NID_Affect_Executed, NID_TP, NID_SL
   - Retry count

2. _Affected_ Dictionary
   - Pairs currently affected by news
   - Associated event, position (BUY/SELL), NID

3. _Trades_ Dictionary
   - All queued/open trades
   - TID, symbol, action, volume, TP, SL, status
   - Strategy, currency, event_type (NEW)
   - Entry/exit prices, times (NEW)
   - PL, MAE, MFE, surprise_strength (NEW)

4. _CurrencyCount_ Dictionary
   - Current exposure per currency
   - Shows which currencies at limit

5. _PairCount_ Dictionary (NEW)
   - Current exposure per pair
   - Shows which pairs at limit

6. _CurrencyPositions_ Dictionary (NEW - S3 only)
   - Active position per currency for rolling mode
   - Pair, action, ticket, TID, NID, entry_time

7. _PairsTraded_ThisWeek_ Dictionary (NEW - S4 only)
   - Which pairs already traded this week
   - Weekly lock status per pair

8. _CurrencySentiment_ Dictionary (NEW - S5 only)
   - Sentiment direction (BULL/BEAR) per currency
   - Confidence level (number of agreeing events)
   - Associated NIDs and TIDs

9. Summary Statistics
   - Total events tracked/processed/pending
   - Total affected pairs
   - Total trades queued/executed/closed
   - Trade status breakdown
   - Currency/pair exposure summary

Example Snapshot:
-----------------
_Currencies_ Dictionary:
  Event Key: EUR_2025-11-07_08:30
    Currency: EUR
    Event: CPI
    Forecast: 2.1
    Actual: 2.8
    Affect: BULL
    NID: 5
    NID_Affect: 3
    NID_Affect_Executed: 2
    NID_TP: 1
    NID_SL: 0

_Trades_ Dictionary:
  TID: TID_5_1
    Symbol: EURUSD
    Action: BUY
    Volume: 0.50
    Status: executed
    Strategy: S2
    Surprise Strength: +0.33
    Entry Price: 1.0850
    MAE: -8.0
    MFE: +28.0

Why This Matters:
-----------------
At any moment, you can open this file and see EXACTLY what the EA is tracking.
How many events are pending? Which pairs are blocked? What's the current
exposure? Essential for monitoring during live operation.


┌──────────────────────────────────────────────────────────────────────────┐
│ 3. TRADES_LOG.CSV - HISTORICAL TRADE RECORDS                            │
└──────────────────────────────────────────────────────────────────────────┘

File: trades_log_YYYYMMDD_HHMMSS.csv (session timestamp)
Type: CSV (append mode)
Purpose: Complete trade history for statistical analysis
Update Frequency: Once per trade (when position closes)
Retention: Permanent (never overwritten)

Structure: 28 Columns per Row
------------------------------
1.  TID                    - Unique trade identifier (TID_5_1)
2.  Strategy               - Which strategy executed (S1, S2, S3, S4, S5)
3.  Currency               - Primary affected currency (EUR, USD, GBP)
4.  Pair                   - Actual traded pair (EURUSD, EURJPY)
5.  Direction              - Trade direction (BUY or SELL)
6.  EventType              - News category (CPI, GDP, NFP, etc.)
7.  EventTime              - News release timestamp
8.  EntryTime              - When trade opened
9.  ExitTime               - When trade closed
10. EntryPrice             - Price at open
11. ExitPrice              - Price at close
12. Duration               - Hold time (minutes)
13. PL_Pips                - Profit/loss (pips)
14. Return_Pct             - % return on account
15. Result                 - WIN | LOSS | BREAKEVEN
16. LotSize                - Position size
17. SL_Hit                 - True if closed via SL
18. TP_Hit                 - True if closed via TP
19. CloseType              - TP | SL | Reversal | WeekEnd | Manual
20. SurpriseStrength       - (Actual - Forecast) / Forecast
21. ReactionDelay          - Entry time - Event time (seconds)
22. Volatility             - High - Low range during trade (pips)
23. MAE                    - Max Adverse Excursion (pips)
24. MFE                    - Max Favorable Excursion (pips)
25. NID                    - News event ID
26. EntryATR               - ATR at entry (S4/S5 only)
27. PositionCount          - 1st, 2nd position for currency (S5 only)
28. SentimentAgreement     - Agrees with prior signal? (S5 only)

Example Row:
------------
TID_5_1,S2,EUR,EURUSD,BUY,CPI,2025-11-07 08:30:00,2025-11-07 08:30:03,
2025-11-07 14:45:12,1.0850,1.0873,375,23.0,0.46,WIN,0.50,False,True,TP,
0.33,3.2,45.0,-8.0,28.0,5,45.0,1,True

Why This Matters:
-----------------
This is your PRIMARY analytical dataset. Every closed trade becomes one row.
After 2-4 weeks, you'll have 5,000-10,000 rows. Load into pandas/Excel for:
- Win rate calculations
- Sharpe ratio analysis
- Correlation studies (surprise vs return)
- Strategy comparison (S1 vs S2 vs S3 vs S4 vs S5)
- Visualization (equity curves, heatmaps, scatter plots)

CRITICAL: This file is APPEND-ONLY. Never delete or modify. It's your source
of truth for the entire testing campaign.


┌──────────────────────────────────────────────────────────────────────────┐
│ 4. WEEKLY_SUMMARY.CSV - AGGREGATED METRICS                              │
└──────────────────────────────────────────────────────────────────────────┘

File: weekly_summary.csv
Type: CSV (append mode)
Purpose: Weekly rolled-up statistics per strategy
Update Frequency: Manual (run weekly_aggregator.py script every Friday)
Retention: Permanent

Structure: 21 Columns per Row
------------------------------
1.  Week                   - Week number (1, 2, 3, 4)
2.  Strategy               - Which strategy (S1, S2, S3, S4, S5)
3.  TotalTrades            - Count of trades this week
4.  WinRate                - (Wins / Total) × 100
5.  AvgReturn              - Mean return per trade (%)
6.  TotalReturn            - Cumulative return for week (%)
7.  StdDev                 - Standard deviation of returns (%)
8.  Sharpe                 - Risk-adjusted return (Avg / StdDev)
9.  MaxDrawdown            - Largest cumulative decline (%)
10. ProfitFactor           - Gross profit / Gross loss
11. TP_Hit_Pct             - % of trades closed at TP
12. SL_Hit_Pct             - % of trades closed at SL
13. AvgReactionDelay       - Mean execution latency (seconds)
14. AvgDuration            - Mean hold time (minutes)
15. ConflictEvents_Pct     - % closed early due to reversal (S3/S5)
16. PairUtilization_Pct    - Unique pairs traded / Total available (%)
17. AvgSurpriseStrength    - Mean surprise strength across trades
18. TopEvent               - Best performing event type
19. TopPair                - Best performing pair
20. RecoveryTime           - Time to recover from max drawdown (hours)
21. WeeklyTarget           - Did it hit +1% target? (True/False)

Example Rows:
-------------
Week,Strategy,TotalTrades,WinRate,AvgReturn,TotalReturn,StdDev,Sharpe,...
1,S1,29,52.0,0.30,8.7,0.69,0.43,...
1,S2,42,57.0,0.31,13.0,0.62,0.50,...
1,S3,38,62.0,0.48,18.5,0.58,0.83,...

Why This Matters:
-----------------
Condenses raw trade data into actionable metrics. After 4 weeks, you'll have
20 rows (5 strategies × 4 weeks). This is what you'll use for strategy ranking:
"S3 had the best Sharpe (0.83) and highest return (18.5%)"


┌──────────────────────────────────────────────────────────────────────────┐
│ 5. STRATEGY_COMPARISON.CSV - FINAL RANKINGS                             │
└──────────────────────────────────────────────────────────────────────────┘

File: strategy_comparison.csv
Type: CSV (generated once at campaign end)
Purpose: Head-to-head comparison of all 5 strategies
Update Frequency: Once (after 4-week campaign completes)
Retention: Permanent

Structure: Same 20 metrics as weekly_summary, but aggregated across all weeks
----------------------------------------------------------------------------
One row per strategy showing cumulative performance

Example:
--------
Strategy,TotalTrades,WinRate,AvgReturn,TotalReturn,StdDev,Sharpe,...
S1,116,52.0,0.30,34.8,0.69,0.43,...
S2,168,57.0,0.31,52.0,0.62,0.50,...
S3,152,62.0,0.48,74.0,0.58,0.83,...
S4,140,54.0,0.32,44.8,0.71,0.45,...
S5,124,48.0,0.20,24.4,0.88,0.23,...

Why This Matters:
-----------------
This is the FINAL ANSWER to "Which strategy wins?"
You'll rank by Sharpe ratio (risk-adjusted return) to determine production model.


┌──────────────────────────────────────────────────────────────────────────┐
│ 6. VISUALIZATION FILES - CHARTS & GRAPHS                                │
└──────────────────────────────────────────────────────────────────────────┘

Files: (Generated by visualizations.py)
---------------------------------------
- equity_curve.png         ← Cumulative return over time (all strategies)
- event_heatmap.png        ← Event type performance grid (S1-S5 × events)
- currency_heatmap.png     ← Currency performance grid (S1-S5 × currencies)
- pair_heatmap.png         ← Pair performance grid (S1-S5 × pairs)
- surprise_vs_return.png   ← Scatter plot (surprise strength vs trade return)
- duration_vs_return.png   ← Scatter plot (hold time vs trade return)
- conflict_impact.png      ← Bar chart (S3/S5 reversal effectiveness)
- summary_table.html       ← HTML table with final rankings

Why This Matters:
-----------------
Humans understand pictures better than numbers. These visualizations reveal
patterns that raw CSV data hides:
- "S3's equity curve is smooth → consistent performance"
- "Surprise strength > 0.5 correlates with larger returns"
- "Holding > 8 hours reduces win rate"


DATA FLOW DIAGRAM
================================================================================

                           ┌─────────────────┐
                           │  NEWS EVENT     │
                           │  (CPI Release)  │
                           └────────┬────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │  STEP 7: Process Event        │
                    │  - Calculate surprise         │
                    │  - Get GPT verdict            │
                    │  - Create trade               │
                    └───────────────┬───────────────┘
                                    │
            ┌───────────────────────┼───────────────────────┐
            │                       │                       │
            ▼                       ▼                       ▼
    ┌──────────────┐        ┌──────────────┐      ┌──────────────┐
    │ OUTPUT.TXT   │        │ _Trades_     │      │ _Currencies_ │
    │ (Console Log)│        │ Dictionary   │      │ Dictionary   │
    │              │        │              │      │              │
    │ "Creating    │        │ TID_5_1:     │      │ NID: 5       │
    │  trade..."   │        │   strategy:S2│      │ NID_Affect:3 │
    └──────────────┘        │   surprise:  │      │ Actual: 2.8  │
                            │   +0.33      │      └──────────────┘
                            └──────┬───────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │  Save to                    │
                    │  news_dictionaries.txt      │
                    │  (Every 30 seconds)         │
                    └──────────────┬──────────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │  MT5 EXECUTES TRADE         │
                    │  - Entry price: 1.0850      │
                    │  - Ticket: 12345            │
                    └──────────────┬──────────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │  MT5 TRACKS POSITION        │
                    │  - MAE: -8 pips             │
                    │  - MFE: +28 pips            │
                    │  - Unrealized P/L           │
                    └──────────────┬──────────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │  MT5 CLOSES POSITION        │
                    │  - Exit price: 1.0873       │
                    │  - Reason: TP               │
                    │  - P/L: +23 pips            │
                    └──────────────┬──────────────┘
                                   │
            ┌──────────────────────┼──────────────────────┐
            │                      │                      │
            ▼                      ▼                      ▼
    ┌──────────────┐      ┌──────────────┐      ┌──────────────┐
    │ OUTPUT.TXT   │      │ _Trades_     │      │ TRADES_LOG   │
    │              │      │ Dictionary   │      │ .CSV         │
    │ "Position    │      │              │      │              │
    │  closed at   │      │ Status:      │      │ TID_5_1,S2,  │
    │  TP +23 pips"│      │ closed       │      │ EUR,EURUSD,  │
    └──────────────┘      │ pl_pips:23.0 │      │ BUY,CPI,...  │
                          │ result:WIN   │      │ +23.0,WIN... │
                          └──────┬───────┘      └──────┬───────┘
                                 │                     │
                                 ▼                     │
                    ┌──────────────────────┐          │
                    │ news_dictionaries    │          │
                    │ .txt                 │          │
                    │ (Updated snapshot)   │          │
                    └──────────────────────┘          │
                                                       │
                            ┌──────────────────────────┘
                            │
                            ▼
                    ┌───────────────────────┐
                    │ FRIDAY: Run           │
                    │ weekly_aggregator.py  │
                    │                       │
                    │ Read trades_log.csv   │
                    │ Calculate 20 metrics  │
                    └───────────┬───────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │ weekly_summary.csv    │
                    │                       │
                    │ Week 1, S2, 42 trades │
                    │ WinRate: 57%          │
                    │ Sharpe: 0.50          │
                    └───────────────────────┘


WHEN TO CHECK EACH FILE
================================================================================

DURING LIVE OPERATION:
----------------------
✅ Output.txt
   Check: Constantly (if debugging)
   Why: See execution flow in real-time

✅ news_dictionaries.txt
   Check: Every few minutes
   Why: Monitor current state (exposure, pending events, queued trades)

❌ trades_log.csv
   Check: Never (during operation)
   Why: Only useful after trades close

AFTER EACH TRADING SESSION:
----------------------------
✅ Output.txt
   Check: If errors occurred
   Why: Trace back what went wrong

✅ news_dictionaries.txt
   Check: At session end
   Why: Verify all positions closed correctly

✅ trades_log.csv
   Check: Verify rows appended
   Why: Ensure data capture working

END OF EACH WEEK:
------------------
✅ trades_log.csv
   Check: Review manually in Excel
   Why: Spot-check data quality before aggregation

✅ Run weekly_aggregator.py
   Why: Generate weekly_summary.csv

✅ weekly_summary.csv
   Check: Compare strategies week-to-week
   Why: See which strategy is leading

END OF 4-WEEK CAMPAIGN:
-----------------------
✅ trades_log.csv
   Check: Final row count (should be 5,000-10,000)
   Why: Verify complete dataset

✅ Run visualizations.py
   Why: Generate all charts and final comparison

✅ strategy_comparison.csv
   Check: Final rankings
   Why: Determine production model


IS THIS SUFFICIENT?
================================================================================

YES, this data capture architecture is sufficient because:

✅ Real-Time Monitoring Covered
   - Output.txt gives live execution flow
   - news_dictionaries.txt gives current state snapshot
   - Both update continuously during operation

✅ Historical Analysis Covered
   - trades_log.csv captures all 28 fields per trade
   - Permanent record, never overwritten
   - Ready for pandas/Excel analysis

✅ Aggregated Metrics Covered
   - weekly_summary.csv condenses into 20 key metrics
   - strategy_comparison.csv provides final rankings

✅ Visualization Covered
   - 7 chart types cover all analytical needs
   - Equity curves, heatmaps, scatter plots, tables

✅ Traceability Covered
   - NID links events to trades
   - TID links trades across all systems
   - Can trace any trade back to originating event

✅ Debugging Covered
   - Output.txt shows every step
   - news_dictionaries.txt shows every state change
   - Can reconstruct exact sequence of any issue

✅ Strategy Comparison Covered
   - 28 trade-level fields capture ALL relevant data
   - 20 aggregate metrics enable fair comparison
   - Sharpe ratio provides risk-adjusted ranking

WHAT'S NOT COVERED (AND WHY IT'S OKAY):
----------------------------------------
❌ Real-time dashboard → Not needed for testing phase
❌ Database storage → CSV handles 10K rows fine
❌ Live API feeds → Post-analysis is sufficient
❌ Automated alerts → Manual monitoring works for 4 weeks
❌ Version control for data → Git + timestamped CSVs enough


POTENTIAL ENHANCEMENTS (OPTIONAL):
-----------------------------------
If you want MORE data visibility, consider:

1. Add "Live Trades" section to news_dictionaries.txt
   Show: Currently open positions with unrealized P/L
   Update: Every heartbeat
   Benefit: See how trades are performing before close

2. Add "Today's Summary" to news_dictionaries.txt
   Show: Today's total trades, win rate, P/L
   Update: After each trade close
   Benefit: Daily performance tracking

3. Add "Weekly Progress" to news_dictionaries.txt
   Show: Current week return, trades to target, days remaining
   Update: After each trade close
   Benefit: Track progress toward +1% weekly target

These are NICE-TO-HAVE, not required. Core architecture is sufficient.


FINAL VERDICT
================================================================================

✅ YES, this data capture architecture is SUFFICIENT for the 4-week testing
   campaign. It provides:

1. Real-time visibility (text files)
2. Historical analysis (CSV files)
3. Aggregated metrics (weekly summaries)
4. Visual insights (charts/graphs)
5. Complete traceability (NID/TID linking)
6. Fair strategy comparison (28 fields × 20 metrics)

No critical data is missing. The hybrid text/CSV approach balances:
- Human readability (text)
- Analytical power (CSV)
- Operational simplicity (no database)
- Data permanence (append-only logs)

You can begin implementing Phase 1 (CSV logging + surprise calculation) with
confidence that this architecture will capture everything needed to answer:
"Which strategy (S1-S5) produces the best risk-adjusted returns?"

================================================================================
END OF DOCUMENT
================================================================================
